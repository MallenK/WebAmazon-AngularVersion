<div class="container mx-auto flex-1 w-full">
    <div class="flex flex-col md:flex-row">
      <!-- Filters Sidebar -->
      <aside class="w-full md:w-64 lg:w-72 p-4 md:p-6 flex-shrink-0">
        <div class="sticky top-24 space-y-8">
          <!-- Comparativas -->
          <div>
            <h2 class="text-xl font-bold mb-4">Comparativas</h2>
            <div class="space-y-2 text-sm">
              <a routerLink="/comparativas/cafeteras-de-capsulas" class="block text-slate-600 hover:text-orange-600 hover:font-semibold transition-all">› de Cápsulas</a>
              <a routerLink="/comparativas/cafeteras-italianas" class="block text-slate-600 hover:text-orange-600 hover:font-semibold transition-all">› Italianas (Moka)</a>
              <a routerLink="/comparativas/cafeteras-expreso" class="block text-slate-600 hover:text-orange-600 hover:font-semibold transition-all">› Exprés Automáticas</a>
            </div>
          </div>
          
          <!-- Filtros -->
          <div>
            <div class="flex justify-between items-center mb-4">
               <h2 class="text-xl font-bold">Filtros</h2>
               <button (click)="resetFilters()" class="text-xs text-orange-600 hover:underline">Limpiar</button>
            </div>
            <div class="space-y-6">
              <div>
                <label for="search" class="font-semibold text-sm mb-2 block font-body">Buscar por nombre o marca</label>
                <input id="search" type="text" [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event)" placeholder="Ej: De'Longhi, Nespresso" class="w-full px-3 py-2 bg-slate-200/60 rounded-md border border-slate-300 focus:outline-none focus:ring-2 focus:ring-orange-500 font-body">
              </div>
              <div>
                <label for="rating" class="font-semibold text-sm mb-2 block font-body">Valoración mínima</label>
                <select id="rating" [ngModel]="minRating()" (ngModelChange)="minRating.set(+$event)" class="w-full px-3 py-2 bg-slate-200/60 rounded-md border border-slate-300 focus:outline-none focus:ring-2 focus:ring-orange-500 font-body">
                  <option value="0">Todas</option>
                  <option value="4">4+ estrellas</option>
                  <option value="3">3+ estrellas</option>
                  <option value="2">2+ estrellas</option>
                  <option value="1">1+ estrellas</option>
                </select>
              </div>
              <div>
                <div class="relative flex items-start">
                  <div class="flex h-6 items-center">
                    <input id="popular" aria-describedby="popular-description" name="popular" type="checkbox" [ngModel]="showPopular()" (ngModelChange)="showPopular.set($event)" class="h-4 w-4 rounded border-slate-300 text-orange-600 focus:ring-orange-500">
                  </div>
                  <div class="ml-3 text-sm leading-6">
                    <label for="popular" class="font-medium text-slate-900 font-body">Popular</label>
                    <p id="popular-description" class="text-slate-500">Mostrar productos destacados</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <main class="flex-1 p-4 md:p-6 border-t md:border-t-0 md:border-l border-slate-200 bg-white">
        <!-- HERO -->
        <section class="mb-12 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800">Encuentra la cafetera perfecta con nuestros análisis expertos</h1>
            <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-600">Análisis independientes de cafeteras</p>
            <p class="mt-4 max-w-3xl mx-auto text-slate-600">En Cafeteras Review probamos y comparamos los mejores modelos del mercado para ofrecerte guías de compra claras y objetivas. Olvídate del marketing y descubre qué cafetera se adapta de verdad a tus gustos, a tu rutina y a tu presupuesto.</p>
            <div class="mt-6 flex flex-wrap justify-center gap-4 text-sm font-semibold">
                <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full">Mejor calidad-precio</span>
                <span class="bg-sky-100 text-sky-800 px-3 py-1 rounded-full">Mejor de cápsulas</span>
                <span class="bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full">Mejor automática</span>
            </div>
        </section>

        <!-- CATEGORIES -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-slate-800 mb-2 text-center">¿Qué tipo de cafetera buscas?</h2>
            <p class="text-center text-slate-600 mb-6">Cada amante del café es un mundo. Empieza por aquí para encontrar tu tipo ideal.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <a routerLink="/comparativas/cafeteras-de-capsulas" class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:shadow-md hover:border-orange-300 transition-all">
                    <h3 class="font-bold text-slate-800">Cafeteras de cápsulas</h3>
                    <p class="text-sm text-slate-500 mt-1">Rapidez, limpieza y consistencia para un café perfecto sin complicaciones.</p>
                </a>
                <a routerLink="/comparativas/cafeteras-expreso" class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:shadow-md hover:border-orange-300 transition-all">
                    <h3 class="font-bold text-slate-800">Espresso automáticas</h3>
                    <p class="text-sm text-slate-500 mt-1">La máxima calidad y personalización, del grano recién molido directamente a tu taza.</p>
                </a>
                <a routerLink="/comparativas/cafeteras-italianas" class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:shadow-md hover:border-orange-300 transition-all">
                    <h3 class="font-bold text-slate-800">Italianas (moka)</h3>
                    <p class="text-sm text-slate-500 mt-1">El ritual y el sabor intenso del café tradicional con un cuerpo inconfundible.</p>
                </a>
                <a routerLink="/comparativas/cafeteras-de-goteo" class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:shadow-md hover:border-orange-300 transition-all">
                    <h3 class="font-bold text-slate-800">De goteo</h3>
                    <p class="text-sm text-slate-500 mt-1">Ideales para preparar mayores cantidades de un café suave y aromático.</p>
                </a>
            </div>
        </section>

        <!-- HOW WE ANALYZE -->
        <section class="mb-12 bg-slate-50 rounded-lg p-6 border border-slate-200">
            <h2 class="text-2xl font-bold text-slate-800">Cómo analizamos las cafeteras</h2>
            <div class="mt-4 flex flex-col md:flex-row gap-6">
                <p class="md:w-2/3 text-slate-600">Nuestra credibilidad es nuestro mayor activo. En Cafeteras Review, cada modelo se somete a un análisis exhaustivo y estandarizado, basado en pruebas de uso real y criterios objetivos. No aceptamos patrocinios de marcas para garantizar que nuestras valoraciones son 100% imparciales y fiables.</p>
                <ul class="md:w-1/3 space-y-2 text-sm">
                    <li class="flex items-center gap-2"><svg class="h-4 w-4 text-emerald-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> <span class="text-slate-700 font-medium">Calidad del café</span></li>
                    <li class="flex items-center gap-2"><svg class="h-4 w-4 text-emerald-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> <span class="text-slate-700 font-medium">Facilidad de uso</span></li>
                    <li class="flex items-center gap-2"><svg class="h-4 w-4 text-emerald-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> <span class="text-slate-700 font-medium">Limpieza y mantenimiento</span></li>
                    <li class="flex items-center gap-2"><svg class="h-4 w-4 text-emerald-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> <span class="text-slate-700 font-medium">Diseño y durabilidad</span></li>
                    <li class="flex items-center gap-2"><svg class="h-4 w-4 text-emerald-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> <span class="text-slate-700 font-medium">Relación calidad-precio</span></li>
                </ul>
            </div>
        </section>
        
        <!-- LATEST ANALYSIS -->
        <section class="mb-12 text-center">
            <h2 class="text-2xl font-bold text-slate-800">Últimos análisis y comparativas</h2>
            <p class="mt-2 max-w-2xl mx-auto text-slate-600">El mercado del café nunca se detiene, y nosotros tampoco. Aquí encontrarás nuestras reviews más recientes y las actualizaciones de nuestras guías de compra para que siempre tengas la información más actual.</p>
        </section>

        <!-- CATALOG -->
        <section class="pt-8 border-t border-slate-200">
             <h2 class="text-2xl font-bold text-slate-800">Explora todo el catálogo</h2>
            <p class="mt-2 mb-6 text-slate-600">Si prefieres investigar por tu cuenta, aquí tienes todos los modelos que hemos analizado. Utiliza los filtros para encontrar rápidamente la cafetera que buscas según tus propios criterios.</p>
            
            <p class="text-sm text-slate-500 mb-4">Mostrando <span class="font-bold text-slate-700">{{ filteredProducts().length }}</span> de <span class="font-bold text-slate-700">{{ allProducts().length }}</span> cafeteras.</p>
            @if (allProducts().length === 0) {
               <div class="text-center py-20 flex flex-col items-center">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-slate-300 mb-4 animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h5M20 20v-5h-5" /><path stroke-linecap="round" stroke-linejoin="round" d="M4 9a9 9 0 0114.65-4.65l-2.43 2.43a5 5 0 00-8.6 4.9" /><path stroke-linecap="round" stroke-linejoin="round" d="M20 15a9 9 0 01-14.65 4.65l2.43-2.43a5 5 0 008.6-4.9" /></svg>
                 <h3 class="text-2xl font-bold text-slate-700">Cargando productos...</h3>
                 <p class="text-slate-500 mt-2 max-w-sm">Contactando con el servidor para obtener el catálogo.</p>
               </div>
            } @else if (filteredProducts().length > 0) {
              @if (totalPages() > 1) {
                <div class="flex items-center justify-center gap-4 mb-6 pb-6 border-b border-slate-200">
                  <button (click)="previousPage()" [disabled]="currentPage() === 1" class="px-4 py-2 text-sm font-semibold rounded-md bg-white border border-slate-300 text-slate-700 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 transition-colors font-body">
                    Anterior
                  </button>
                  <span class="text-sm text-slate-600">
                    Página <span class="font-bold text-slate-800">{{ currentPage() }}</span> de <span class="font-bold text-slate-800">{{ totalPages() }}</span>
                  </span>
                  <button (click)="nextPage()" [disabled]="currentPage() === totalPages()" class="px-4 py-2 text-sm font-semibold rounded-md bg-white border border-slate-300 text-slate-700 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 transition-colors font-body">
                    Siguiente
                  </button>
                </div>
              }

              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                @for (product of paginatedProducts(); track product.id) {
                  <app-product-card [product]="product" (quickView)="handleQuickView($event)" />
                }
              </div>

              @if (totalPages() > 1) {
                <div class="flex items-center justify-center gap-4 mt-8 pt-6 border-t border-slate-200">
                  <button (click)="previousPage()" [disabled]="currentPage() === 1" class="px-4 py-2 text-sm font-semibold rounded-md bg-white border border-slate-300 text-slate-700 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 transition-colors font-body">
                    Anterior
                  </button>
                  <span class="text-sm text-slate-600">
                    Página <span class="font-bold text-slate-800">{{ currentPage() }}</span> de <span class="font-bold text-slate-800">{{ totalPages() }}</span>
                  </span>
                  <button (click)="nextPage()" [disabled]="currentPage() === totalPages()" class="px-4 py-2 text-sm font-semibold rounded-md bg-white border border-slate-300 text-slate-700 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 transition-colors font-body">
                    Siguiente
                  </button>
                </div>
              }
            } @else {
              <div class="text-center py-20 flex flex-col items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-slate-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                <h3 class="text-2xl font-bold text-slate-700">No se encontraron cafeteras</h3>
                <p class="text-slate-500 mt-2 max-w-sm">Prueba a cambiar o limpiar los filtros para ver más resultados.</p>
                <button (click)="resetFilters()" class="mt-6 px-4 py-2 bg-orange-500 text-white rounded-md text-sm hover:bg-orange-600 transition-colors">Limpiar todos los filtros</button>
              </div>
            }
        </section>
      </main>
    </div>

    <!-- Quick View Modal -->
    @if (quickViewProduct(); as product) {
    <div class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 animate-fade-in" (click)="closeQuickView()">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl flex flex-col md:flex-row relative animate-slide-in-up" (click)="$event.stopPropagation()">
        <button (click)="closeQuickView()" title="Cerrar vista rápida" class="absolute top-3 right-3 text-slate-500 hover:text-slate-800 transition-colors p-1 rounded-full hover:bg-slate-100 z-10">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <!-- Image Column -->
        <div class="w-full md:w-1/2 p-6 bg-slate-50 flex items-center justify-center rounded-t-lg md:rounded-l-lg md:rounded-tr-none">
            @if (product.image_url) {
            <img [src]="product.image_url" [alt]="product.name" class="max-h-80 object-contain">
            } @else {
            <div class="w-full h-80 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 text-slate-300" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M3 14c.83 .642 2.077 1.017 3.5 1c1.423 .017 2.67 -.358 3.5 -1c.83 -.642 2.077 -1.017 3.5 -1c1.423 -.017 2.67 .358 3.5 1" />
                <path d="M8 3a2.4 2.4 0 0 0 -1 2a2.4 2.4 0 0 0 1 2" />
                <path d="M12 3a2.4 2.4 0 0 0 -1 2a2.4 2.4 0 0 0 1 2" />
                <path d="M3 10h14v5a6 6 0 0 1 -6 6h-2a6 6 0 0 1 -6 -6v-5z" />
                <path d="M16.746 16.726a3 3 0 1 0 .252 -5.555" />
                </svg>
            </div>
            }
        </div>
        <!-- Details Column -->
        <div class="w-full md:w-1/2 p-6 flex flex-col">
            <h2 class="text-2xl font-bold text-slate-800">{{ product.name }}</h2>
            <div class="flex items-center gap-2 mt-2 text-sm text-slate-500 mb-4">
            @if(product.rating_num) {
                <div class="flex items-center gap-1 text-amber-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                <span class="font-bold text-slate-700">{{ product.rating_num }}</span>
                </div>
                @if(product.reviews_count) { <span class="text-slate-300">|</span> }
            }
            @if(product.reviews_count) {
                <span>{{ product.reviews_count }} reseñas</span>
            }
            </div>
            <p class="text-slate-600 text-sm mb-6 flex-grow">
            Este es un vistazo rápido al producto. Para un análisis en profundidad y nuestra valoración editorial, visita la ficha completa del producto. Consulta siempre Amazon para ver el precio final y la disponibilidad.
            </p>
            <div class="mt-auto pt-4 flex flex-col sm:flex-row gap-3">
            <a [routerLink]="['/producto', product.asin]" (click)="closeQuickView()" class="block w-full sm:w-1/2 bg-slate-200 hover:bg-slate-300 text-slate-800 font-bold py-3 px-4 rounded-lg text-center transition-colors duration-300">
                Ver Análisis
            </a>
            <a [href]="product.amazon_url" target="_blank" rel="noopener sponsored" class="block w-full sm:w-1/2 bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg text-center transition-colors duration-300">
                Ver en Amazon
            </a>
            </div>
        </div>
        </div>
    </div>
    }
</div>